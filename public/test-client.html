<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Poll Test Client</title>
  </head>
  <body>
    <h1>Real-Time Poll Tester</h1>

    <div>
      <label>Poll ID: <input id="pollId" /></label>
      <button id="joinBtn">Join Poll</button>
    </div>

    <div>
      <label>Option ID: <input id="optionId" /></label>
      <label>User ID: <input id="userId" /></label>
      <button id="voteBtn">Cast Vote</button>
    </div>

    <pre id="log"></pre>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
      const log = (msg) => {
        document.getElementById("log").textContent += msg + "\n";
      };

      const socket = io("/polls"); // namespace

      document.getElementById("joinBtn").onclick = () => {
        const pollId = document.getElementById("pollId").value;
        socket.emit("join_poll", { pollId });
        log(`Joined poll ${pollId}`);
      };

      document.getElementById("voteBtn").onclick = async () => {
        const pollId = document.getElementById("pollId").value;
        const optionId = document.getElementById("optionId").value;
        const userId = document.getElementById("userId").value;

        const res = await fetch(`/api/polls/${pollId}/votes`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ userId, pollOptionId: optionId }),
        });
        log(`Vote response: ${res.status}`);
      };

      socket.on("poll_results", (data) => {
        log(`Live results: ${JSON.stringify(data)}`);
      });

      socket.on("poll_error", (err) => {
        log(`Error: ${err.message}`);
      });
    </script>
  </body>
</html>
